import { fillPDFFormFields, prepareSALNData } from '../../../api/pdfExporter.js';
import { getFormFromIDB } from '../../../utils/idb.js';

export interface Input {
  // salnData: Object;
  salnID: string;
  idx: Number;
}

static async function handleExportPDF(salnID, idx) {
  try {
    console.log(`Getting Saln Data of salnID ${salnID} from IDB.`);
    const salnData = await getFormFromIDB(salnID);
    console.log(`Gotten Saln Data of salnID ${salnID} from IDB.`);

    console.log("Exporting form %d to PDF", idx);
    
    // Prepare SALN data for PDF
    const preparedData = prepareSALNData(salnData);
    console.log('Prepared SALN data:', preparedData);
    
    // Fill the PDF and trigger download
    const result = await fillPDFFormFields(preparedData);
    
    if (result.success) {
      console.log('✓ PDF downloaded successfully!');
    } else {
      console.error('✗ PDF export failed:', result.message);
    }
  } catch (error) {
    console.error('Error exporting PDF:', error);
  }
}

<let/isExporting = false>

<button 
  class="exportButton"
  onClick() {
    if (isExporting) return;
    isExporting = true;
    handleExportPDF(input.salnID, input.idx).finally(() => {
      isExporting = false;
    });
  }
  disabled=isExporting
>
  PDF
</button>